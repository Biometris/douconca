<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>douconca • douconca</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="douconca">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">douconca</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/douconca.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Biometris/douconca/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>douconca</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Biometris/douconca/blob/main/vignettes/douconca.Rmd" class="external-link"><code>vignettes/douconca.Rmd</code></a></small>
      <div class="d-none name"><code>douconca.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://zenodo.org/records/13970152" class="external-link">douconca</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 class="unnumbered" id="the-douconca-package">The douconca package<a class="anchor" aria-label="anchor" href="#the-douconca-package"></a>
</h2>
<p>The aim of the <code>douconca</code> package is to help ecologists
unravel trait-environment relationships from an abundance data table
with associated multi-trait and multi-environment data tables. A popular
method to such aim is RLQ <span class="citation">(<a href="#ref-doledec1996RLQ">Dolédec et al. 1996</a>; <a href="#ref-dray2014RLQ">Dray et al. 2014</a>)</span>, which also a
three-tables method. RLQ is available in the R-package <code>ade4</code>
<span class="citation">(<a href="#ref-dray2007ade4">Dray and Dufour
2007</a>; <a href="#ref-thioulouse2018multivariate">Thioulouse et al.
2018</a>)</span>. The <code>douconca</code> package provides an
alternative method, termed double-constrained correspondence analysis
(dc-CA), which is a natural extension of the commonly used method of
community-weighted means (CWMs) regression <span class="citation">(<a href="#ref-BraakRossum2025">ter Braak and van Rossum 2025</a>; <a href="#ref-Braak2018dcCA">Ter Braak, Šmilauer, and Dray 2018</a>; <a href="#ref-kleyer2012assessing">Kleyer et al. 2012</a>)</span>.<br>
As dc-CA is based on both regression analysis and ordination (factorial
analysis), it allows for the usual forms of testing, model building, and
of biplots of resulting scores.</p>
<p>The value of dc-CA compared to RLQ, GLMM3 and CWM-regression is
discussed, with examples, in ter Braak and van Rossum (2025).</p>
<p>The <code>douconca</code> package has a
<code>formula</code>-interface to specify the dc-CA model, and
<code>scores</code>, <code>anova</code>, <code>plot</code> and
<code>predict</code> functions, mostly fairly similar to those in the
<code>vegan</code> package <span class="citation">(<a href="#ref-oksanen_vegan2024">Oksanen et al. 2024</a>)</span> on to
which <code>douconca</code> is based.</p>
</div>
<div class="section level2">
<h2 id="double-constained-correspondence-analysis">Double constained correspondence analysis<a class="anchor" aria-label="anchor" href="#double-constained-correspondence-analysis"></a>
</h2>
<p>As RLQ, dc-CA seeks for an ordination (i.e. a low-dimensional
representation of) of the multi-trait, multi-environment relationships,
but dc-CA differs from RLQ in that dc-CA is based on regression with the
traits and environmental variables as predictors, whereas RLQ is based
on co-variance. The dc-CA method thus allows for variation-partitioning
and the type of model-building that is familiar to users of regression
analysis, whereas RLQ does not.</p>
<p>A dc-CA axis consists of two regression models (linear combinations),
one of traits and the other of environmental predictors, the fitted
values of which can be thought of as a composite trait and a composite
environmental gradient. The response variables of these regressions are
species niche centroids and CWMs of such composites. This circularity is
typical for any eigenvalue ordination method. The linear combinations
maximizes the fourth-corner correlation between the composite trait and
composite environmental gradient. The dc-CA eigenvalues are squared
fourth-corner correlations, but also variances, namely the amounts of
variation in the abundance data that the consecutive axes explain <span class="citation">(<a href="#ref-Braak2018dcCA">Ter Braak, Šmilauer, and
Dray 2018</a>)</span>.</p>
<p>Statistical testing is by the max test <span class="citation">(<a href="#ref-Braak2012max_test">Ter Braak, Cormont, and Dray
2012</a>)</span>, evaluated by extensive simulation <span class="citation">(<a href="#ref-Braak2019MEE">Ter Braak
2019</a>)</span>. This test combines two permutations tests, one
permuting sites and the other permuting species, the maximum P-value of
which is the final P-value. As in the <code>vegan</code> package, the
permutations are specified via the <code>permute</code> package <span class="citation">(<a href="#ref-permute2022">Simpson 2022</a>)</span>,
so as to allow for analysis of hierarchical and nested data designs
<span class="citation">(<a href="#ref-gobbi2022hay">Gobbi et al.
2022</a>)</span>.</p>
<p>In <code>douconca</code>, a dc-CA model is specified by two formulas:
a <code>formula</code> for the sites (rows) with environmental
predictors and a <code>formula</code> for the species (columns) with
trait predictors, which both may contain factors, quantitative variables
and transformations thereof, and interactions, like in any (generalized)
linear regression model. The formulas specify the constraints applied to
the site and species scores; without constraints dc-CA is simply
correspondence analysis.</p>
<p>The double constrained version of principal components analysis also
exists and is available in the Canoco software <span class="citation">(<a href="#ref-Braak2018canoco">Ter Braak and Šmilauer
2018</a>)</span>, but has less appeal in ecological applications as it
lacks ecological realism, ease of interpretation and the link to
methods, such as CWM-regression and fourth-corner correlation analysis,
which have proven to be useful in trait-based ecology.</p>
<p>A full-length treatment of dc-CA, with examples, is given in ter
Braak and van Rossum (2025).<br>
# Example data and questions</p>
<p>We use the <code>dune_trait_env</code> data in the package to
illustrate dc-CA. It consists of the abundances of 28 plant species in
20 meadows (plots, here called sites), trait data for these plant
species and environmental data of these sites.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://zenodo.org/records/13970152" class="external-link">douconca</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"dune_trait_env"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dune_trait_env</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "comm"   "traits" "envir"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">dune_trait_env</span><span class="op">$</span><span class="va">comm</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co">## without the variable "Sites"</span></span>
<span><span class="co">#&gt; [1] 20 28</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">dune_trait_env</span><span class="op">$</span><span class="va">traits</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 28 11</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">dune_trait_env</span><span class="op">$</span><span class="va">envir</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 20 10</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dune_trait_env</span><span class="op">$</span><span class="va">traits</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "Species"      "Species_abbr" "SLA"          "Height"       "LDMC"        </span></span>
<span><span class="co">#&gt;  [6] "Seedmass"     "Lifespan"     "F"            "R"            "N"           </span></span>
<span><span class="co">#&gt; [11] "L"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dune_trait_env</span><span class="op">$</span><span class="va">envir</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "Sites"  "A1"     "Moist"  "Mag"    "Use"    "Manure" "X"      "Y"     </span></span>
<span><span class="co">#&gt;  [9] "X_lot"  "Y_lot"</span></span></code></pre></div>
<p>There are five morphological traits (from the <code>LEDA</code> trait
database) and four ecological traits (Ellenberg indicator values for
moisture (F), acidity (R), nutrients (N) and light (L)).</p>
<p>There are five environmental variables and two sets of two spatial
coordinates, which are approximately equal. The <code>X</code> and
<code>Y</code> are the coordinates of the plot. The lot-variables are
the center of the meadow where the sample has been taken.</p>
<p>The type of questions that dc-CA is able to address is:</p>
<ul>
<li>How many dimenstions are needed to represent the major part of the
trait-environment relations?</li>
<li>Is the trait-environment relationship statistically
significant?</li>
<li>How many dimensions are statistically significant?</li>
<li>What is the importance of a variable in a dc-CA axis?</li>
<li>What is trait-structured variation and which of the trait sets has
the larger such variation?</li>
<li>Which of the trait sets (morphological versus ecological) is more
closely related to the environmental variables?</li>
</ul>
<div class="section level3">
<h3 id="basic-analysis">Basic analysis<a class="anchor" aria-label="anchor" href="#basic-analysis"></a>
</h3>
<p>The next code gives a basic dc-CA analysis. The response matrix or
data frame must be numerical, with columns representing the species. The
first variable (<code>Sites</code>) must therefore be deleted.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">dune_trait_env</span><span class="op">$</span><span class="va">comm</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="co"># must delete "Sites"</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dc_CA.html">dc_CA</a></span><span class="op">(</span>formulaEnv <span class="op">=</span> <span class="op">~</span> <span class="va">A1</span> <span class="op">+</span> <span class="va">Moist</span> <span class="op">+</span> <span class="va">Use</span> <span class="op">+</span> <span class="va">Manure</span> <span class="op">+</span> <span class="va">Mag</span>,</span>
<span>             formulaTraits <span class="op">=</span> <span class="op">~</span> <span class="va">SLA</span> <span class="op">+</span> <span class="va">Height</span> <span class="op">+</span> <span class="va">LDMC</span> <span class="op">+</span> <span class="va">Seedmass</span> <span class="op">+</span> <span class="va">Lifespan</span>,</span>
<span>             response <span class="op">=</span> <span class="va">Y</span>,</span>
<span>             dataEnv <span class="op">=</span> <span class="va">dune_trait_env</span><span class="op">$</span><span class="va">envir</span>,</span>
<span>             dataTraits <span class="op">=</span> <span class="va">dune_trait_env</span><span class="op">$</span><span class="va">traits</span><span class="op">)</span></span>
<span><span class="co">#&gt; Step 1: the CCA ordination of the transposed matrix with trait constraints,</span></span>
<span><span class="co">#&gt;         useful in itself and also yielding CWMs of the orthonormalized traits for step 2.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call: cca0(formula = formulaTraits, response = tY, data =</span></span>
<span><span class="co">#&gt; out0$data$dataTraits)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;               Inertia Proportion Rank</span></span>
<span><span class="co">#&gt; Total          2.3490     1.0000     </span></span>
<span><span class="co">#&gt; Constrained    0.6776     0.2885    5</span></span>
<span><span class="co">#&gt; Unconstrained  1.6714     0.7115   19</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Inertia is scaled Chi-square</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Eigenvalues for constrained axes:</span></span>
<span><span class="co">#&gt;    CCA1    CCA2    CCA3    CCA4    CCA5 </span></span>
<span><span class="co">#&gt; 0.26839 0.19597 0.12356 0.07003 0.01967 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Eigenvalues for unconstrained axes:</span></span>
<span><span class="co">#&gt; CA1 CA2 CA3 CA4 CA5 CA6 CA7 CA8 </span></span>
<span><span class="co">#&gt;  NA  NA  NA  NA  NA  NA  NA  NA </span></span>
<span><span class="co">#&gt; (Showing 8 of 19 unconstrained eigenvalues)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; mean, sd, VIF and canonical coefficients with their optimistic [!] t-values:</span></span>
<span><span class="co">#&gt;                        Avg     SDS    VIF   Regr1   tval1</span></span>
<span><span class="co">#&gt; SLA                24.6468  6.3438 1.1888  0.4401  4.1794</span></span>
<span><span class="co">#&gt; Height             25.1272 15.6848 1.3033  0.1283  1.1640</span></span>
<span><span class="co">#&gt; LDMC              244.5084 70.9729 1.1791  0.0278  0.2647</span></span>
<span><span class="co">#&gt; Seedmass            0.6543  0.6688 1.0784  0.3708  3.6980</span></span>
<span><span class="co">#&gt; Lifespanperennial   0.9607  0.1944 1.0964 -0.0578 -0.5718</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Step 2: the RDA ordination of CWMs of the orthonormalized traits </span></span>
<span><span class="co">#&gt;         of step 1 with environmental constraints:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call: rda(formula = out1$CWMs_orthonormal_traits ~ A1 + Moist + Use +</span></span>
<span><span class="co">#&gt; Manure + Mag, data = out1$data$dataEnv)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;               Inertia Proportion Rank</span></span>
<span><span class="co">#&gt; Total          0.6776     1.0000     </span></span>
<span><span class="co">#&gt; Constrained    0.4454     0.6573    5</span></span>
<span><span class="co">#&gt; Unconstrained  0.2322     0.3427    5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Inertia is variance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Eigenvalues for constrained axes:</span></span>
<span><span class="co">#&gt;    RDA1    RDA2    RDA3    RDA4    RDA5 </span></span>
<span><span class="co">#&gt; 0.23680 0.10903 0.05934 0.03792 0.00233 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Eigenvalues for unconstrained axes:</span></span>
<span><span class="co">#&gt;     PC1     PC2     PC3     PC4     PC5 </span></span>
<span><span class="co">#&gt; 0.12017 0.05836 0.03455 0.01337 0.00575 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; mean, sd, VIF and canonical coefficients with their optimistic [!] t-values:</span></span>
<span><span class="co">#&gt;         Avg    SDS    VIF   Regr1   tval1</span></span>
<span><span class="co">#&gt; A1     4.85 2.1240 1.6967 -0.0605 -0.9172</span></span>
<span><span class="co">#&gt; Moist  2.90 1.7578 1.7658  0.3250  4.8293</span></span>
<span><span class="co">#&gt; Use    1.90 0.7681 1.7825  0.0219  0.3239</span></span>
<span><span class="co">#&gt; Manure 1.75 1.4448 9.3847 -0.1444 -0.9306</span></span>
<span><span class="co">#&gt; MagBF  0.15 0.3571 4.5016 -0.0475 -0.4421</span></span>
<span><span class="co">#&gt; MagHF  0.25 0.4330 2.6715 -0.0156 -0.1890</span></span>
<span><span class="co">#&gt; MagNM  0.30 0.4583 9.5666  0.1622  1.0352</span></span>
<span><span class="co">#&gt;                        Avg     SDS    VIF   Regr1   tval1</span></span>
<span><span class="co">#&gt; SLA                24.6468  6.3438 1.1888 -0.8196 -3.6933</span></span>
<span><span class="co">#&gt; Height             25.1272 15.6848 1.3033 -0.1598 -0.6877</span></span>
<span><span class="co">#&gt; LDMC              244.5084 70.9729 1.1791 -0.0562 -0.2542</span></span>
<span><span class="co">#&gt; Seedmass            0.6543  0.6688 1.0784 -0.7586 -3.5896</span></span>
<span><span class="co">#&gt; Lifespanperennial   0.9607  0.1944 1.0964  0.1006  0.4722</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                weighted variance</span></span>
<span><span class="co">#&gt; total                      2.349</span></span>
<span><span class="co">#&gt; traits_explain             0.678</span></span>
<span><span class="co">#&gt; env_explain                1.323</span></span>
<span><span class="co">#&gt; constraintsTE              0.445</span></span>
<span><span class="co">#&gt; attr(,"meaning")</span></span>
<span><span class="co">#&gt;                meaning                                                                </span></span>
<span><span class="co">#&gt; total          "total inertia (= weighted variation)"                                 </span></span>
<span><span class="co">#&gt; traits_explain "trait-constrained variation"                                          </span></span>
<span><span class="co">#&gt; env_explain    "environment-constrained variation"                                    </span></span>
<span><span class="co">#&gt; constraintsTE  "trait-constrained variation explained by the predictors in formulaEnv"</span></span></code></pre></div>
<p>In <code>douconca</code>, dc-CA is calculated in two steps that
provide useful information each. Step 1 of the dc-CA algorithm
summarizes the canonical correspondence analysis (CCA) of the transposed
response matrix on to the trait data using
<code>formulaTraits = ~ SLA + Height + LDMC + Seedmass + Lifespan</code>.
The morphological traits in this formula explain 28.85% of the total
inertia (variance) in the abundance data <code>Y</code>. This inertia
(0.6776) is called the trait-structured variation. Inertia is in general
a weighted variance, but in this case it is thus unweighted as sites
have equal weight in the analysis, because
<code>divideBySiteTotals</code> is true by defaults. Formally, it is the
total (unweighted) variance in the community weighted means of
orthonormalized traits (the traits are orthonormalized in Step 1). The
trait-structured variation is further analyzed in Step 2 using
redundancy analysis (RDA). Step 2 shows that 65.73% of this variation
can be explained by the environmental variables using
<code>formulaEnv = ~ A1 + Moist + Use + Manure + Mag</code>. The
constrained axes of this RDA are also the dc-CA eigenvalues:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span><span class="op">$</span><span class="va">eigenvalues</span></span>
<span><span class="co">#&gt;      dcCA1      dcCA2      dcCA3      dcCA4      dcCA5 </span></span>
<span><span class="co">#&gt; 0.23680387 0.10903220 0.05933626 0.03791909 0.00232876</span></span></code></pre></div>
<p>The first axis explains 53% of the trait-environment variance and
this axis is dominated by moisture and by SLA and Seedmass, as judged by
the size of their regression coefficient and (optimistic) t-value on
this axis in the print of the model. The default <code>plot</code> shows
the intra-set correlations of the variables with the axis, but t-values
can be visualized with</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod</span>, gradient_description <span class="op">=</span> <span class="st">"t"</span><span class="op">)</span></span></code></pre></div>
<p><img src="douconca_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="statistical-testing">Statistical testing<a class="anchor" aria-label="anchor" href="#statistical-testing"></a>
</h3>
<p>There are two-ways to statistically test the model: (1) the omnibus
test (using all five dimensions) is obtained with
<code>anova(mod)</code>, giving a P-value of about 0.02 and (2) a test
per dc-CA axis, obtained by</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">mod</span>, by <span class="op">=</span> <span class="st">"axis"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $species</span></span>
<span><span class="co">#&gt; Species-level permutation test using dc-CA</span></span>
<span><span class="co">#&gt; Model: dc_CA(formulaEnv = ~A1 + Moist + Use + Manure + Mag, formulaTraits = ~SLA + Height + LDMC + Seedmass + Lifespan, response = Y, dataEnv = dune_trait_env$envir, dataTraits = dune_trait_env$traits) </span></span>
<span><span class="co">#&gt; Residualized predictor permutation</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          df ChiSquare       R2      F Pr(&gt;F)  </span></span>
<span><span class="co">#&gt; dcCA1     1   0.23680 0.179002 5.9370  0.087 .</span></span>
<span><span class="co">#&gt; dcCA2     1   0.10903 0.082419 2.7336  0.476  </span></span>
<span><span class="co">#&gt; dcCA3     1   0.05934 0.044853 1.4877  0.760  </span></span>
<span><span class="co">#&gt; dcCA4     1   0.03792 0.028663 0.9507  0.816  </span></span>
<span><span class="co">#&gt; dcCA5     1   0.00233 0.001760 0.0584  1.000  </span></span>
<span><span class="co">#&gt; Residual 22   0.87749                         </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $sites</span></span>
<span><span class="co">#&gt;          Df ChiSquare      R2       F Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; dcCA1     1  0.236804 0.34946 12.2380  0.001 ***</span></span>
<span><span class="co">#&gt; dcCA2     1  0.109032 0.16090  7.0435  0.003 ** </span></span>
<span><span class="co">#&gt; dcCA3     1  0.059336 0.08757  4.0887  0.041 *  </span></span>
<span><span class="co">#&gt; dcCA4     1  0.037919 0.05596  2.7762  0.132    </span></span>
<span><span class="co">#&gt; dcCA5     1  0.002329 0.00344  0.1805  0.953    </span></span>
<span><span class="co">#&gt; Residual 14  0.232199                           </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $maxP</span></span>
<span><span class="co">#&gt; Max test combining the community- and species- level tests </span></span>
<span><span class="co">#&gt; Model: dc_CA(formulaEnv = ~A1 + Moist + Use + Manure + Mag, formulaTraits = ~SLA + Height + LDMC + Seedmass + Lifespan, response = Y, dataEnv = dune_trait_env$envir, dataTraits = dune_trait_env$traits) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Taken from the species-level test:</span></span>
<span><span class="co">#&gt; Residualized predictor permutation</span></span>
<span><span class="co">#&gt; Permutation: free</span></span>
<span><span class="co">#&gt; Number of permutations: 999</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          df ChiSquare       R2      F Pr(&gt;F)  </span></span>
<span><span class="co">#&gt; dcCA1     1   0.23680 0.179002 5.9370  0.087 .</span></span>
<span><span class="co">#&gt; dcCA2     1   0.10903 0.082419 2.7336  0.476  </span></span>
<span><span class="co">#&gt; dcCA3     1   0.05934 0.044853 1.4877  0.760  </span></span>
<span><span class="co">#&gt; dcCA4     1   0.03792 0.028663 0.9507  0.816  </span></span>
<span><span class="co">#&gt; dcCA5     1   0.00233 0.001760 0.0584  1.000  </span></span>
<span><span class="co">#&gt; Residual 22   0.87749                         </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>In the test per axis, the first axis has P-values of 0.09 and 0.001
at the species- and site-level, respectively, so that the P-value of the
max test is 0.09. A little more explanation may be instructive. The
species-level test consists of testing the (weighted) regression of the
species-niche-centroids with respect to orthonormalized environmental
variables against the traits. The site-level test consists of testing
the (in this case, unweighted) regression of the community-weighted
means of orthonormalized traits against the environmental variables.
Both tests are carried out by permutation, the first by permuting
species in the trait data, the second by permuting sites in the
environmental data. A new dc-CA is carried out for each permuted data
set. For a full description see under Details in the help system.</p>
</div>
<div class="section level3">
<h3 id="fitted-values-and-predictions">Fitted values and predictions<a class="anchor" aria-label="anchor" href="#fitted-values-and-predictions"></a>
</h3>
<p>There are three kinds of fitted values (and of predictions for new
data):</p>
<ul>
<li>fitted traits per site, obtained with
<code>predict(mod, type = "traits" )</code>
</li>
<li>fitted environmental values per species, obtained with
<code>predict(mod, type = "env")</code>
</li>
<li>fitted abundances, obtained with
<code>predict(mod, type = "response" )</code>
</li>
</ul>
<p>The fitted traits per site are simply fitted community-weighted means
and the fitted environmental values are fitted species-niche centroids,
as is clearer from the statements <code>fitted(mod, type = "CWM")</code>
and <code>fitted(mod, type = "SNC")</code>, respectively. Note that 10%
of the fitted abundance values is negative in our example. Negative
values indicate likely absences or low abundance values of species with
the specified traits and environmental values.</p>
</div>
</div>
<div class="section level2">
<h2 id="which-set-of-traits-is-most-closely-related-to-abundance-and-to-the-environment">Which set of traits is most closely related to abundance and to the
environment?<a class="anchor" aria-label="anchor" href="#which-set-of-traits-is-most-closely-related-to-abundance-and-to-the-environment"></a>
</h2>
<p>In this section, we pose the question whether the set of
morphological (functional) traits is more or less related to species
abundance and to the environmental variables than the set of ecological
traits.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_e</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/dc_CA.html">dc_CA</a></span><span class="op">(</span>formulaEnv <span class="op">=</span> <span class="op">~</span> <span class="va">A1</span> <span class="op">+</span> <span class="va">Moist</span> <span class="op">+</span> <span class="va">Manure</span> <span class="op">+</span> <span class="va">Use</span> <span class="op">+</span> <span class="va">Mag</span>,</span>
<span>                formulaTraits <span class="op">=</span> <span class="op">~</span> <span class="cn">F</span> <span class="op">+</span> <span class="va">R</span> <span class="op">+</span> <span class="va">N</span> <span class="op">+</span> <span class="va">L</span>,</span>
<span>                response <span class="op">=</span> <span class="va">Y</span>,</span>
<span>                dataEnv <span class="op">=</span> <span class="va">dune_trait_env</span><span class="op">$</span><span class="va">envir</span>,</span>
<span>                dataTraits <span class="op">=</span> <span class="va">dune_trait_env</span><span class="op">$</span><span class="va">traits</span><span class="op">)</span></span>
<span><span class="co">#&gt; Step 1: the CCA ordination of the transposed matrix with trait constraints,</span></span>
<span><span class="co">#&gt;         useful in itself and also yielding CWMs of the orthonormalized traits for step 2.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call: cca0(formula = formulaTraits, response = tY, data =</span></span>
<span><span class="co">#&gt; out0$data$dataTraits)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;               Inertia Proportion Rank</span></span>
<span><span class="co">#&gt; Total          2.3490     1.0000     </span></span>
<span><span class="co">#&gt; Constrained    0.8701     0.3704    4</span></span>
<span><span class="co">#&gt; Unconstrained  1.4789     0.6296   19</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Inertia is scaled Chi-square</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Eigenvalues for constrained axes:</span></span>
<span><span class="co">#&gt;   CCA1   CCA2   CCA3   CCA4 </span></span>
<span><span class="co">#&gt; 0.4771 0.3122 0.0580 0.0228 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Eigenvalues for unconstrained axes:</span></span>
<span><span class="co">#&gt; CA1 CA2 CA3 CA4 CA5 CA6 CA7 CA8 </span></span>
<span><span class="co">#&gt;  NA  NA  NA  NA  NA  NA  NA  NA </span></span>
<span><span class="co">#&gt; (Showing 8 of 19 unconstrained eigenvalues)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; mean, sd, VIF and canonical coefficients with their optimistic [!] t-values:</span></span>
<span><span class="co">#&gt;      Avg    SDS    VIF   Regr1   tval1</span></span>
<span><span class="co">#&gt; F 6.1126 1.6685 1.1323  0.6048  8.2493</span></span>
<span><span class="co">#&gt; R 5.8061 1.1894 1.7564  0.0170  0.1865</span></span>
<span><span class="co">#&gt; N 5.1674 1.6303 1.7822 -0.1358 -1.4764</span></span>
<span><span class="co">#&gt; L 7.3839 0.8774 1.1378  0.1424  1.9382</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Step 2: the RDA ordination of CWMs of the orthonormalized traits </span></span>
<span><span class="co">#&gt;         of step 1 with environmental constraints:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call: rda(formula = out1$CWMs_orthonormal_traits ~ A1 + Moist + Manure +</span></span>
<span><span class="co">#&gt; Use + Mag, data = out1$data$dataEnv)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;               Inertia Proportion Rank</span></span>
<span><span class="co">#&gt; Total          0.8701     1.0000     </span></span>
<span><span class="co">#&gt; Constrained    0.6331     0.7277    4</span></span>
<span><span class="co">#&gt; Unconstrained  0.2369     0.2723    4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Inertia is variance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Eigenvalues for constrained axes:</span></span>
<span><span class="co">#&gt;   RDA1   RDA2   RDA3   RDA4 </span></span>
<span><span class="co">#&gt; 0.3684 0.2452 0.0141 0.0054 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Eigenvalues for unconstrained axes:</span></span>
<span><span class="co">#&gt;     PC1     PC2     PC3     PC4 </span></span>
<span><span class="co">#&gt; 0.14787 0.06377 0.01573 0.00954 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; mean, sd, VIF and canonical coefficients with their optimistic [!] t-values:</span></span>
<span><span class="co">#&gt;         Avg    SDS    VIF   Regr1   tval1</span></span>
<span><span class="co">#&gt; A1     4.85 2.1240 1.6967  0.1527  1.3122</span></span>
<span><span class="co">#&gt; Moist  2.90 1.7578 1.7658  0.4584  3.8618</span></span>
<span><span class="co">#&gt; Manure 1.75 1.4448 9.3847  0.0243  0.0888</span></span>
<span><span class="co">#&gt; Use    1.90 0.7681 1.7825  0.0886  0.7432</span></span>
<span><span class="co">#&gt; MagBF  0.15 0.3571 4.5016 -0.0086 -0.0452</span></span>
<span><span class="co">#&gt; MagHF  0.25 0.4330 2.6715  0.0136  0.0930</span></span>
<span><span class="co">#&gt; MagNM  0.30 0.4583 9.5666  0.1136  0.4110</span></span>
<span><span class="co">#&gt;      Avg    SDS    VIF   Regr1   tval1</span></span>
<span><span class="co">#&gt; F 6.1126 1.6685 1.1323  0.8158  6.0720</span></span>
<span><span class="co">#&gt; R 5.8061 1.1894 1.7564 -0.1812 -1.0830</span></span>
<span><span class="co">#&gt; N 5.1674 1.6303 1.7822 -0.1905 -1.1304</span></span>
<span><span class="co">#&gt; L 7.3839 0.8774 1.1378  0.3043  2.2594</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                weighted variance</span></span>
<span><span class="co">#&gt; total                      2.349</span></span>
<span><span class="co">#&gt; traits_explain             0.870</span></span>
<span><span class="co">#&gt; env_explain                1.323</span></span>
<span><span class="co">#&gt; constraintsTE              0.633</span></span>
<span><span class="co">#&gt; attr(,"meaning")</span></span>
<span><span class="co">#&gt;                meaning                                                                </span></span>
<span><span class="co">#&gt; total          "total inertia (= weighted variation)"                                 </span></span>
<span><span class="co">#&gt; traits_explain "trait-constrained variation"                                          </span></span>
<span><span class="co">#&gt; env_explain    "environment-constrained variation"                                    </span></span>
<span><span class="co">#&gt; constraintsTE  "trait-constrained variation explained by the predictors in formulaEnv"</span></span></code></pre></div>
<p>The entry <code>traits_explain</code> is 0.87, which is the variance
in the abundance data that is explained by the traits. It can directly
be compared to the corresponding entry in the previous model, which is
0.678. The entry <code>constraintsTE</code> is the variance in abundance
data that is explained by traits and environmental variables jointly.
Its value in the second model is higher than that in the first. On
closer examination of the results, the second eigenvalue of the last
model is even higher than the first one of the first model and, indeed,
the first two dc-CA axes are significant as can be seen from an
<code>anova</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">mod_e</span>, by <span class="op">=</span> <span class="st">"axis"</span><span class="op">)</span><span class="op">$</span><span class="va">max</span></span>
<span><span class="co">#&gt; Max test combining the community- and species- level tests </span></span>
<span><span class="co">#&gt; Model: dc_CA(formulaEnv = ~A1 + Moist + Manure + Use + Mag, formulaTraits = ~F + R + N + L, response = Y, dataEnv = dune_trait_env$envir, dataTraits = dune_trait_env$traits) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; a mix the species- (traits) and community- (environment) levels:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;       df ChiSquare traitP  envP Pr(&gt;F)   </span></span>
<span><span class="co">#&gt; dcCA1  1   0.36835  0.001 0.002  0.002 **</span></span>
<span><span class="co">#&gt; dcCA2  1   0.24525  0.001 0.002  0.002 **</span></span>
<span><span class="co">#&gt; dcCA3  1   0.01413  0.984 0.675  0.984   </span></span>
<span><span class="co">#&gt; dcCA4  1   0.00541  0.993 0.704  0.993   </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>The fourth-corner correlation of the best linear combination of the
ecological traits with the best linear combination of the environmental
variables is</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">mod_e</span><span class="op">$</span><span class="va">eigenvalues</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; dcCA1 </span></span>
<span><span class="co">#&gt;  0.61</span></span></code></pre></div>
<p>compared to 0.49 for the best linear combination of the morphological
traits. In conclusion, the ecological traits explain more of the
abundance data and are closer related to the environmental
variables.</p>
</div>
<div class="section level2">
<h2 id="do-the-morphological-traits-contribute-after-accounting-for-the-ecological-traits">Do the morphological traits contribute after accounting for the
ecological traits?<a class="anchor" aria-label="anchor" href="#do-the-morphological-traits-contribute-after-accounting-for-the-ecological-traits"></a>
</h2>
<p>Do the morphological traits carry important additional information on
the species (beyond their ecological traits) for understanding which
species occur where? (i.e. for understanding the species-environment
relationships). To address this question, specify the ecological traits
as <code>Condition</code> in the trait formula and perform an
<code>anova</code> of the resulting model.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_mGe</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/dc_CA.html">dc_CA</a></span><span class="op">(</span>formulaEnv <span class="op">=</span> <span class="op">~</span> <span class="va">A1</span> <span class="op">+</span> <span class="va">Moist</span> <span class="op">+</span> <span class="va">Manure</span> <span class="op">+</span> <span class="va">Use</span> <span class="op">+</span> <span class="va">Mag</span>,</span>
<span>                 formulaTraits <span class="op">=</span> <span class="op">~</span> <span class="va">SLA</span> <span class="op">+</span> <span class="va">Height</span> <span class="op">+</span> <span class="va">LDMC</span> <span class="op">+</span> <span class="va">Seedmass</span> <span class="op">+</span> <span class="va">Lifespan</span> <span class="op">+</span></span>
<span>                   <span class="fu">Condition</span><span class="op">(</span><span class="cn">F</span> <span class="op">+</span> <span class="va">R</span> <span class="op">+</span> <span class="va">N</span> <span class="op">+</span> <span class="va">L</span><span class="op">)</span>,</span>
<span>                 response <span class="op">=</span> <span class="va">Y</span>,</span>
<span>                 dataEnv <span class="op">=</span> <span class="va">dune_trait_env</span><span class="op">$</span><span class="va">envir</span>,</span>
<span>                 dataTraits <span class="op">=</span> <span class="va">dune_trait_env</span><span class="op">$</span><span class="va">traits</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">mod_mGe</span>, by<span class="op">=</span> <span class="st">"axis"</span><span class="op">)</span><span class="op">$</span><span class="va">max</span></span>
<span><span class="co">#&gt; Max test combining the community- and species- level tests </span></span>
<span><span class="co">#&gt; Model: dc_CA(formulaEnv = ~A1 + Moist + Manure + Use + Mag, formulaTraits = ~SLA + Height + LDMC + Seedmass + Lifespan + Condition(F + R + N + L), response = Y, dataEnv = dune_trait_env$envir, dataTraits = dune_trait_env$traits, verbose = FALSE) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Taken from the species-level test:</span></span>
<span><span class="co">#&gt; Residualized predictor permutation</span></span>
<span><span class="co">#&gt; Permutation: free</span></span>
<span><span class="co">#&gt; Number of permutations: 999</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          df ChiSquare       R2      F Pr(&gt;F)</span></span>
<span><span class="co">#&gt; dcCA1     1   0.09333 0.135306 3.4800  0.183</span></span>
<span><span class="co">#&gt; dcCA2     1   0.07101 0.102951 2.6479  0.280</span></span>
<span><span class="co">#&gt; dcCA3     1   0.03381 0.049017 1.2607  0.837</span></span>
<span><span class="co">#&gt; dcCA4     1   0.00629 0.009115 0.2344  1.000</span></span>
<span><span class="co">#&gt; dcCA5     1   0.00259 0.003761 0.0967  1.000</span></span>
<span><span class="co">#&gt; Residual 18   0.48274</span></span></code></pre></div>
<p>As jugded by the test of significance by axes, there is little
evidence that the morphological traits contribute to the explanation of
(environmentally structured) abundance of species.</p>
</div>
<div class="section level2">
<h2 id="one-trait-cwm-regression-without-inflated-type-i-error-">One trait: CWM regression without inflated type I error.<a class="anchor" aria-label="anchor" href="#one-trait-cwm-regression-without-inflated-type-i-error-"></a>
</h2>
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>CWM regression is know to suffer from serious type I error inflation
in statistical testing <span class="citation">(<a href="#ref-peres2017linking">Peres-Neto, Dray, and Ter Braak 2017</a>;
<a href="#ref-lepvs2023differences">Lepš and De Bello 2023</a>)</span>.
This section shows how to perform CWM regression of a single trait using
dc-CA with a <code>max</code> test to guard against type I error
inflation. This test does not suffer from the, sometimes extreme,
conservativeness of the ZS (Zelený &amp; Schaffers) modified test <span class="citation">(<a href="#ref-Braak2018simple">Ter Braak, Peres-Neto,
and Dray 2018</a>; <a href="#ref-lepvs2023differences">Lepš and De Bello
2023</a>)</span>.</p>
<p>We also show the equivalence of the site-level test with that of a
CWM-regression and the equivalence of the dc-CA and CWM regression
coefficients. On the way, we give examples of the <code>scores</code>
and <code>fCWM_SNC</code> functions in the <code>douconca</code>
package.</p>
</div>
<div class="section level3">
<h3 id="testing-the-relationship-between-ldmc-and-the-environmental-variables">Testing the relationship between LDMC and the environmental
variables<a class="anchor" aria-label="anchor" href="#testing-the-relationship-between-ldmc-and-the-environmental-variables"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_LDMC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dc_CA.html">dc_CA</a></span><span class="op">(</span>formulaEnv <span class="op">=</span> <span class="op">~</span> <span class="va">A1</span> <span class="op">+</span> <span class="va">Moist</span> <span class="op">+</span> <span class="va">Manure</span> <span class="op">+</span> <span class="va">Use</span> <span class="op">+</span> <span class="va">Mag</span>,</span>
<span>                   formulaTraits <span class="op">=</span> <span class="op">~</span> <span class="va">LDMC</span>,</span>
<span>                   response <span class="op">=</span> <span class="va">Y</span>, </span>
<span>                   dataEnv <span class="op">=</span> <span class="va">dune_trait_env</span><span class="op">$</span><span class="va">envir</span>,</span>
<span>                   dataTraits <span class="op">=</span> <span class="va">dune_trait_env</span><span class="op">$</span><span class="va">trait</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">mod_LDMC</span><span class="op">)</span></span>
<span><span class="co">#&gt; $species</span></span>
<span><span class="co">#&gt; Species-level permutation test using dc-CA</span></span>
<span><span class="co">#&gt; Model: dc_CA(formulaEnv = ~A1 + Moist + Manure + Use + Mag, formulaTraits = ~LDMC, response = Y, dataEnv = dune_trait_env$envir, dataTraits = dune_trait_env$trait, verbose = FALSE) </span></span>
<span><span class="co">#&gt; Residualized predictor permutation</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          df ChiSquare       R2      F Pr(&gt;F)</span></span>
<span><span class="co">#&gt; dcCA      1   0.05605 0.042368 1.1503  0.396</span></span>
<span><span class="co">#&gt; Residual 26   1.26686                       </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $sites</span></span>
<span><span class="co">#&gt;          Df ChiSquare      R2      F Pr(&gt;F)  </span></span>
<span><span class="co">#&gt; dcCA1     7  0.056048 0.67074 3.4922  0.028 *</span></span>
<span><span class="co">#&gt; Residual 12  0.027513                        </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $maxP</span></span>
<span><span class="co">#&gt; Max test combining the community- and species- level tests </span></span>
<span><span class="co">#&gt; Model: dc_CA(formulaEnv = ~A1 + Moist + Manure + Use + Mag, formulaTraits = ~LDMC, response = Y, dataEnv = dune_trait_env$envir, dataTraits = dune_trait_env$trait, verbose = FALSE) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Taken from the species-level test:</span></span>
<span><span class="co">#&gt; Residualized predictor permutation</span></span>
<span><span class="co">#&gt; Permutation: free</span></span>
<span><span class="co">#&gt; Number of permutations: 999</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          df ChiSquare       R2      F Pr(&gt;F)</span></span>
<span><span class="co">#&gt; dcCA      1   0.05605 0.042368 1.1503  0.396</span></span>
<span><span class="co">#&gt; Residual 26   1.26686</span></span></code></pre></div>
<p>The P-values of the species-level and site-level permutation tests
are 0.396 and 0.028, respectively, so that the final P-value is 0.396.
There is thus no evidence that the trait LDMC is related to the
environmental variables in the model.</p>
<p>We now show that performing CWM-regression only would lead to the
opposite conclusion. For this, we first calculate the CWMs of LDMC,
using the function <code>fCWM_SNC</code>, the arguments of which are
similar to that of the <code>dc_CA</code> function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CWMSNC_LDMC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fCWM_SNC.html">fCWM_SNC</a></span><span class="op">(</span>formulaEnv <span class="op">=</span> <span class="op">~</span> <span class="va">A1</span> <span class="op">+</span> <span class="va">Moist</span> <span class="op">+</span> <span class="va">Manure</span> <span class="op">+</span> <span class="va">Use</span> <span class="op">+</span> <span class="va">Mag</span>,</span>
<span>                        formulaTraits <span class="op">=</span> <span class="op">~</span> <span class="va">LDMC</span>,</span>
<span>                        response <span class="op">=</span> <span class="va">Y</span>, </span>
<span>                        dataEnv <span class="op">=</span> <span class="va">dune_trait_env</span><span class="op">$</span><span class="va">envir</span>,</span>
<span>                        dataTraits <span class="op">=</span> <span class="va">dune_trait_env</span><span class="op">$</span><span class="va">trait</span><span class="op">)</span></span></code></pre></div>
<p>The result, <code>CWMSNC_LDMC</code>, is a list containing the CWMs
of LDMC, among other items. We combine the (community-weighted) mean
LDMC to the environmental data, apply linear regresion and compare the
model with the null model using <code>anova</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">envCWM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">dune_trait_env</span><span class="op">$</span><span class="va">envir</span>, <span class="va">CWMSNC_LDMC</span><span class="op">$</span><span class="va">CWM</span><span class="op">)</span></span>
<span><span class="va">lmLDMC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">LDMC</span> <span class="op">~</span> <span class="va">A1</span> <span class="op">+</span> <span class="va">Moist</span> <span class="op">+</span> <span class="va">Manure</span> <span class="op">+</span> <span class="va">Use</span> <span class="op">+</span> <span class="va">Mag</span>, data <span class="op">=</span> <span class="va">envCWM</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">lmLDMC</span>, <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">LDMC</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">envCWM</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis of Variance Table</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model 1: LDMC ~ A1 + Moist + Manure + Use + Mag</span></span>
<span><span class="co">#&gt; Model 2: LDMC ~ 1</span></span>
<span><span class="co">#&gt;   Res.Df    RSS Df Sum of Sq      F Pr(&gt;F)  </span></span>
<span><span class="co">#&gt; 1     12 2771.8                             </span></span>
<span><span class="co">#&gt; 2     19 8418.3 -7   -5646.5 3.4922 0.0279 *</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>resulting in a P-value of 0.0279, which is in agreement with the
P-value of the site-level permutation test of this model. CWM-regression
of LDMC shows evidence for a relationship with the environmental
variables whereas there is in fact very little evidence as shown by
dc-CA.</p>
</div>
<div class="section level3">
<h3 id="the-coefficients-of-a-cwm-regression-are-proportional-to-those-of-dc-ca">The coefficients of a CWM-regression are proportional to those of
dc-CA<a class="anchor" aria-label="anchor" href="#the-coefficients-of-a-cwm-regression-are-proportional-to-those-of-dc-ca"></a>
</h3>
<p>The introduction said that dc-CA extends CWM-regression to multiple
traits. We now show that the regression coefficients issued by dc-CA
with a single trait are, up to a scaling constant, identical to those of
a linear CWM-regression of this trait.</p>
<p>We first extract the regression coefficients from the dc-CA model
using the <code>scores</code> function. The second line calculates the
regression coefficients by dividing the standardize regression
coefficients from <code>dc_CA</code> by the standard deviation of each
environmental variable.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">regr_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://vegandevs.github.io/vegan/reference/scores.html" class="external-link">scores</a></span><span class="op">(</span><span class="va">mod_LDMC</span>, display <span class="op">=</span> <span class="st">"reg"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;         Avg       SDS      VIF       dcCA1</span></span>
<span><span class="co">#&gt; A1     4.85 2.1240292 1.696694 -0.16636060</span></span>
<span><span class="co">#&gt; Moist  2.90 1.7578396 1.765817 -0.02346540</span></span>
<span><span class="co">#&gt; Manure 1.75 1.4448183 9.384723  0.78784718</span></span>
<span><span class="co">#&gt; Use    1.90 0.7681146 1.782458 -0.33963301</span></span>
<span><span class="co">#&gt; MagBF  0.15 0.3570714 4.501582  0.25168168</span></span>
<span><span class="co">#&gt; MagHF  0.25 0.4330127 2.671474  0.09905591</span></span>
<span><span class="co">#&gt; MagNM  0.30 0.4582576 9.566575  0.71778929</span></span>
<span><span class="co">#&gt; attr(,"meaning")</span></span>
<span><span class="co">#&gt; [1] "mean, sd, VIF, standardized regression coefficients."</span></span>
<span><span class="va">coefs_LDMC_dcCA</span> <span class="op">&lt;-</span> <span class="va">regr_table</span><span class="op">[</span>, <span class="st">"dcCA1"</span><span class="op">]</span> <span class="op">/</span> <span class="va">regr_table</span><span class="op">[</span>, <span class="st">"SDS"</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lmLDMC</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="va">coefs_LDMC_dcCA</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 34.53293 34.53293</span></span></code></pre></div>
<p>The result shows that the two sets of coefficients are equal up to a
constant of proportionality, here 154.4359. The t-values are also
equal:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lmLDMC</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>, <span class="st">"t value"</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>,</span>
<span><span class="fu"><a href="https://vegandevs.github.io/vegan/reference/scores.html" class="external-link">scores</a></span><span class="op">(</span><span class="va">mod_LDMC</span>, display <span class="op">=</span> <span class="st">"tval"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;           t value      dcCA1</span></span>
<span><span class="co">#&gt; A1     -1.2978033 -1.2978033</span></span>
<span><span class="co">#&gt; Moist  -0.1794383 -0.1794383</span></span>
<span><span class="co">#&gt; Manure  2.6133127  2.6133127</span></span>
<span><span class="co">#&gt; Use    -2.5849991 -2.5849991</span></span>
<span><span class="co">#&gt; MagBF   1.2053943  1.2053943</span></span>
<span><span class="co">#&gt; MagHF   0.6158360  0.6158360</span></span>
<span><span class="co">#&gt; MagNM   2.3581903  2.3581903</span></span></code></pre></div>
<p>Alternatively, we can use
<code>coef(mod_LDMC,  type = "env2traits",normed = FALSE)</code> which
give the same values as <code>coef(lmLDMC)[-1]</code>. # References</p>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-doledec1996RLQ" class="csl-entry">
Dolédec, Sylvain, Daniel Chessel, Cajo JF Ter Braak, and Stéphane
Champely. 1996. <span>“Matching Species Traits to Environmental
Variables: A New Three-Table Ordination Method.”</span>
<em>Environmental and Ecological Statistics</em> 3: 143–66.
</div>
<div id="ref-dray2014RLQ" class="csl-entry">
Dray, Stéphane, Philippe Choler, Sylvain Dolédec, Pedro R Peres-Neto,
Wilfried Thuiller, Sandrine Pavoine, and Cajo JF Ter Braak. 2014.
<span>“Combining the Fourth-Corner and the RLQ Methods for Assessing
Trait Responses to Environmental Variation.”</span> <em>Ecology</em> 95
(1): 14–21.
</div>
<div id="ref-dray2007ade4" class="csl-entry">
Dray, Stéphane, and Anne-Béatrice Dufour. 2007. <span>“The Ade4 Package:
Implementing the Duality Diagram for Ecologists.”</span> <em>Journal of
Statistical Software</em> 22: 1–20.
</div>
<div id="ref-gobbi2022hay" class="csl-entry">
Gobbi, Mauro, Luca Corlatti, Marco Caccianiga, Cajo JF Ter Braak, and
Luca Pedrotti. 2022. <span>“Hay Meadows’ Overriding Effect Shapes Ground
Beetle Functional Diversity in Mountainous Landscapes.”</span>
<em>Ecosphere</em> 13 (8): e4193.
</div>
<div id="ref-kleyer2012assessing" class="csl-entry">
Kleyer, Michael, Stéphane Dray, Francescode Bello, Jan Lepš, Robin J
Pakeman, Barbara Strauss, Wilfried Thuiller, and Sandra Lavorel. 2012.
<span>“Assessing Species and Community Functional Responses to
Environmental Gradients: Which Multivariate Methods?”</span> <em>Journal
of Vegetation Science</em> 23 (5): 805–21.
</div>
<div id="ref-lepvs2023differences" class="csl-entry">
Lepš, Jan, and Francesco De Bello. 2023. <span>“Differences in
Trait–Environment Relationships: Implications for Community Weighted
Means Tests.”</span> <em>Journal of Ecology</em> 111 (11): 2328–41.
</div>
<div id="ref-oksanen_vegan2024" class="csl-entry">
Oksanen, Jari, Gavin L. Simpson, F. Guillaume Blanchet, Roeland Kindt,
Pierre Legendre, Peter R. Minchin, R. B. O’Hara, Peter Solymos, et al.
2024. <em>Vegan: Community Ecology Package</em>. <a href="https://CRAN.R-project.org/package=vegan" class="external-link">https://CRAN.R-project.org/package=vegan</a>.
</div>
<div id="ref-peres2017linking" class="csl-entry">
Peres-Neto, Pedro R, Stéphane Dray, and Cajo JF Ter Braak. 2017.
<span>“Linking Trait Variation to the Environment: Critical Issues with
Community-Weighted Mean Correlation Resolved by the Fourth-Corner
Approach.”</span> <em>Ecography</em> 40 (7): 806–16.
</div>
<div id="ref-permute2022" class="csl-entry">
Simpson, Gavin L. 2022. <em>Permute: Functions for Generating Restricted
Permutations of Data</em>. <a href="https://CRAN.R-project.org/package=permute" class="external-link">https://CRAN.R-project.org/package=permute</a>.
</div>
<div id="ref-BraakRossum2025" class="csl-entry">
ter Braak, Cajo J. F., and Bart-Jan van Rossum. 2025. <span>“Linking
Multivariate Trait Variation to the Environment: The Advantages of
Double Constrained Correspondence Analysis with the r Package
Douconca.”</span> <em>Ecological Informatics</em> 88: 103143.
https://doi.org/<a href="https://doi.org/10.1016/j.ecoinf.2025.103143" class="external-link">https://doi.org/10.1016/j.ecoinf.2025.103143</a>.
</div>
<div id="ref-Braak2019MEE" class="csl-entry">
Ter Braak, Cajo JF. 2019. <span>“New Robust Weighted Averaging-and
Model-Based Methods for Assessing Trait–Environment
Relationships.”</span> <em>Methods in Ecology and Evolution</em> 10
(11): 1962–71.
</div>
<div id="ref-Braak2012max_test" class="csl-entry">
Ter Braak, Cajo JF, Anouk Cormont, and Stéphane Dray. 2012.
<span>“Improved Testing of Species Traits–Environment Relationships in
the Fourth-Corner Problem.”</span> <em>Ecology</em> 93 (7): 1525–26.
</div>
<div id="ref-Braak2018simple" class="csl-entry">
Ter Braak, Cajo JF, Pedro R Peres-Neto, and Stéphane Dray. 2018.
<span>“Simple Parametric Tests for Trait–Environment
Association.”</span> <em>Journal of Vegetation Science</em> 29 (5):
801–11.
</div>
<div id="ref-Braak2018canoco" class="csl-entry">
Ter Braak, Cajo JF, and Petr Šmilauer. 2018. <span>“Canoco Reference
Manual and User’s Guide: Software for Ordination, Version 5.10.”</span>
</div>
<div id="ref-Braak2018dcCA" class="csl-entry">
Ter Braak, Cajo JF, Petr Šmilauer, and Stéphane Dray. 2018.
<span>“Algorithms and Biplots for Double Constrained Correspondence
Analysis.”</span> <em>Environmental and Ecological Statistics</em> 25
(2): 171–97.
</div>
<div id="ref-thioulouse2018multivariate" class="csl-entry">
Thioulouse, Jean, Stéphane Dray, Anne-Béatrice Dufour, Aurélie
Siberchicot, Thibaut Jombart, and Sandrine Pavoine. 2018.
<em>Multivariate Analysis of Ecological Data with Ade4</em>. Springer.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Cajo J.F ter Braak, Bart-Jan van Rossum.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
